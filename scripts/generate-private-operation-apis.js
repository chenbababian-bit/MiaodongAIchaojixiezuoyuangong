const fs = require('fs');
const path = require('path');

// 私域运营8个子分类的完整数据
const PRIVATE_OPERATION_DATA = {
  "用户增长": [
    { id: 14001, title: "目标用户画像分析报告", desc: "撰写一份详细的目标用户画像分析报告，为私域运营提供精准的用户信息和策略建议。" },
    { id: 14002, title: "用户获取渠道效果分析", desc: "对私域运营中的用户获取渠道效果进行深入分析，为优化运营策略提供依据。" },
    { id: 14003, title: "引流活动策划方案", desc: "制定一份具有吸引力和实效性的引流活动策划方案，提高品牌知名度，增加私域流量池的用户数量。" },
    { id: 14004, title: "新用户欢迎指南", desc: "撰写一份全面、吸引人的新用户欢迎指南，帮助新用户快速了解品牌、产品或服务，并引导他们积极参与私域互动。" },
    { id: 14005, title: "用户激活策略文档", desc: "撰写一份详细的《用户激活策略文档》，帮助企业有效地激活私域用户，提高用户活跃度和忠诚度。" },
    { id: 14006, title: "用户留存率提升计划", desc: "制定一套全面的用户留存率提升计划，以增加用户在私域中的活跃度和粘性。" },
    { id: 14007, title: "用户生命周期价值(LTV)模型", desc: "构建一个完善的用户生命周期价值（LTV）模型，以帮助企业更好地理解用户价值并制定相应的运营策略。" },
    { id: 14008, title: "用户增长黑客技巧手册", desc: "编写一份详细的《用户增长黑客技巧手册》，帮助企业提升私域用户的数量和质量。" },
    { id: 14009, title: "社交媒体引流文案", desc: "撰写具有吸引力和感染力的社交媒体引流文案，引导用户进入私域流量池。" },
    { id: 14010, title: "线下活动用户转化报告", desc: "撰写一份详细的《线下活动用户转化报告》，分析活动效果，为后续活动提供参考和改进方向。" },
  ],
  "社群运营": [
    { id: 14011, title: "用户分级制度与权益说明", desc: "制定一套科学合理的用户分级制度，并明确各级用户的权益，以提高用户满意度和忠诚度。" },
    { id: 14012, title: "社群话题讨论策划", desc: "制定一份详细的社群话题讨论策划，提高社群活跃度和用户参与度。" },
    { id: 14013, title: "社群KOL合作邀请信", desc: "撰写一封具有吸引力的社群KOL合作邀请信，促成合作。" },
    { id: 14014, title: "社群用户调研问卷", desc: "设计一份全面、准确且有针对性的《社群用户调研问卷》，以深入了解社群用户的特征、需求和行为，为私域运营提供有力支持。" },
    { id: 14015, title: "社群危机公关预案", desc: "制定一套全面的《社群危机公关预案》，确保在危机发生时能够迅速、有效地进行应对，最大程度减少对社群和品牌的负面影响。" },
    { id: 14016, title: "社群建立与规划书", desc: "撰写一份详细的《社群建立与规划书》，帮助企业构建活跃、有价值的社群生态。" },
    { id: 14017, title: "社群规则与管理规范", desc: "制定一套全面、合理的《社群规则与管理规范》，确保社群的秩序和活跃度，提升用户体验和参与度。" },
    { id: 14018, title: "社群活跃度提升方案", desc: "制定一套切实可行的《社群活跃度提升方案》，提高社群成员的参与度和粘性，促进社群的持续发展。" },
    { id: 14019, title: "社群内容日历", desc: "制定一份详细且实用的社群内容日历，确保社群内容的多样性、及时性和吸引力。" },
    { id: 14020, title: "社群管理员培训资料", desc: "编写一套全面、系统的社群管理员培训资料，帮助管理员提升专业能力和工作效率。" },
  ],
  "内容生产": [
    { id: 14021, title: "内容创意与编辑指南", desc: "制定一份详细的《内容创意与编辑指南》，帮助私域运营团队提升内容质量和效果，实现用户增长和转化。" },
    { id: 14022, title: "内容营销策略文档", desc: "制定一份详细的内容营销策略文档，以提高私域流量的活跃度和转化率。" },
    { id: 14023, title: "内容质量标准与审核流程", desc: "制定一套完善的《内容质量标准与审核流程》，确保私域内容的高质量和合规性。" },
    { id: 14024, title: "用户原创内容(UGC)激励机制", desc: "制定一套完善的用户原创内容激励机制，提高用户参与度和内容质量。" },
    { id: 14025, title: "内容效果监测与优化报告", desc: "撰写一份详细的《内容效果监测与优化报告》，为私域运营提供决策依据。" },
    { id: 14026, title: "内容分发渠道策略", desc: "制定一套有效的内容分发渠道策略，提高内容的传播效果和用户参与度。" },
    { id: 14027, title: "内容日程安排表", desc: "制定一份详细、合理且具有吸引力的内容日程安排表，以提高私域用户的活跃度和忠诚度。" },
    { id: 14028, title: "品牌故事文案", desc: "创作一篇能够吸引目标受众、传递品牌独特魅力的品牌故事文案。" },
    { id: 14029, title: "行业资讯简报", desc: "撰写一份全面、准确、有价值的行业资讯简报，为私域运营决策提供参考依据。" },
    { id: 14030, title: "用户教育材料与教程", desc: "编写一套全面、系统、易懂的用户教育材料与教程，帮助用户更好地理解和使用相关产品或服务，提高用户满意度和忠诚度。" },
  ],
  "用户互动": [
    { id: 14031, title: "用户问题常见解答(FAQ)", desc: "编写一份全面、详细且易于理解的《用户问题常见解答(FAQ)》，涵盖私域运营中的常见问题。" },
    { id: 14032, title: "用户反馈处理流程", desc: "制定一套完善的用户反馈处理流程，确保用户反馈得到及时、准确的处理，提高用户满意度。" },
    { id: 14033, title: "用户满意度调查报告", desc: "撰写一份详细的《用户满意度调查报告》，为私域运营策略的调整提供依据。" },
    { id: 14034, title: "用户故事征集与展示", desc: "设计一套有效的用户故事征集与展示方案，提升用户对私域平台的关注度和参与度。" },
    { id: 14035, title: "用户忠诚度奖励计划", desc: "制定一套有效的用户忠诚度奖励计划，提高用户的参与度和忠诚度。" },
    { id: 14036, title: "用户生日/纪念日问候", desc: "制定一套完善的用户生日/纪念日问候方案，提高用户对品牌的好感度和忠诚度。" },
    { id: 14037, title: "客户关怀邮件模板", desc: "设计一套能够有效传递关怀、增强客户粘性的客户关怀邮件模板。" },
    { id: 14038, title: "用户活动参与邀请", desc: "撰写一份能够吸引用户参与活动的邀请文案。" },
    { id: 14039, title: "用户体验改进提案", desc: "撰写一份详细的《用户体验改进提案》，以提升私域运营中的用户体验。" },
    { id: 14040, title: "用户访谈记录与分析", desc: "撰写一份详细、准确的用户访谈记录与分析报告，为私域运营策略提供依据。" },
  ],
  "数据分析": [
    { id: 14041, title: "用户行为分析报告", desc: "撰写一份详细且有洞察力的《用户行为分析报告》，为私域运营提供决策依据。" },
    { id: 14042, title: "私域流量池分析", desc: "撰写一份详细的《私域流量池分析》，为企业的私域运营提供有力的支持。" },
    { id: 14043, title: "消息打开率与点击率统计", desc: "撰写一份详细的《消息打开率与点击率统计》方案，为私域运营提供有力的数据支持和策略指导。" },
    { id: 14044, title: "用户参与度指标追踪", desc: "撰写一份详细的《用户参与度指标追踪》方案，为私域运营提供科学的决策依据。" },
    { id: 14045, title: "社群影响力评估", desc: "构建一套全面、科学的社群影响力评估体系，为私域运营提供有力的决策支持。" },
    { id: 14046, title: "用户流失原因分析", desc: "撰写一份详细的《用户流失原因分析》报告，为私域运营提供决策依据。" },
    { id: 14047, title: "竞品私域运营对比分析", desc: "完成一份详细的竞品私域运营对比分析报告，为企业的私域运营提供参考和建议。" },
    { id: 14048, title: "用户分层与个性化推荐策略", desc: "制定一套完善的用户分层与个性化推荐策略，提升私域用户的活跃度和购买转化率。" },
    { id: 14049, title: "数据驱动的营销决策建议", desc: "撰写一份数据驱动的营销决策建议，帮助企业提升私域运营效果，实现客户增长和转化。" },
    { id: 14050, title: "定期运营状况汇报", desc: "撰写一份详细、准确的定期运营状况汇报，为团队提供决策依据。" },
  ],
  "营销转化": [
    { id: 14051, title: "营销活动策划与执行指南", desc: "为用户提供一份详细且实用的《营销活动策划与执行指南》，帮助用户在私域运营中成功策划和执行营销活动。" },
    { id: 14052, title: "促销优惠文案与设计", desc: "撰写一份详细的《促销优惠文案与设计》，提高促销活动的效果和转化率。" },
    { id: 14053, title: "转化漏斗分析与优化", desc: "撰写一份详细的《转化漏斗分析与优化》方案，帮助用户提升私域运营的转化效果。" },
    { id: 14054, title: "销售线索跟踪与管理", desc: "制定一套完善的销售线索跟踪与管理方案，提高销售线索的转化率和客户满意度。" },
    { id: 14055, title: "产品推介邮件模板", desc: "设计一个有效的产品推介邮件模板，提高产品的知名度和销售量。" },
    { id: 14056, title: "用户购买意向调查", desc: "设计一份有效的《用户购买意向调查》，以准确了解用户的购买意向和需求。" },
    { id: 14057, title: "客户案例研究与分享", desc: "撰写一份具有深度和实用性的《客户案例研究与分享》，为私域运营提供有益的参考和借鉴。" },
    { id: 14058, title: "用户试用申请与反馈收集", desc: "设计一套完善的用户试用申请与反馈收集流程，提高用户参与度和反馈质量。" },
    { id: 14059, title: "限时折扣通知", desc: "撰写一份吸引人的限时折扣通知，激发用户的购买欲望，提高活动参与度和转化率。" },
    { id: 14060, title: "会员专属优惠券发放", desc: "设计一套完善的会员专属优惠券发放方案，提高会员的活跃度和忠诚度，促进消费增长。" },
  ],
  "团队管理": [
    { id: 14061, title: "团队角色与职责说明书", desc: "制定一份详细的《团队角色与职责说明书》，明确私域运营团队中各个角色的职责和工作内容，提高团队的协作效率和运营效果。" },
    { id: 14062, title: "团队目标设定与KPI考核", desc: "制定一套科学合理的团队目标设定与KPI考核方案，提高私域运营团队的工作效率和业绩。" },
    { id: 14063, title: "私域运营培训课程大纲", desc: "帮助学员系统地掌握私域运营的方法和技巧，提升其在私域运营方面的能力和水平。" },
    { id: 14064, title: "最佳实践分享与案例学习", desc: "编写一份详细的《最佳实践分享与案例学习》，为企业提供私域运营的参考和借鉴。" },
    { id: 14065, title: "团队沟通与协作规则", desc: "制定一套完善的《团队沟通与协作规则》，提高团队工作效率和协作效果。" },
    { id: 14066, title: "团队建设活动策划", desc: "设计一份具有针对性和吸引力的团队建设活动方案，增强团队成员之间的沟通与协作，提升团队凝聚力。" },
    { id: 14067, title: "绩效评估与个人发展计划", desc: "制定一套科学合理的私域运营绩效评估体系和个人发展计划，以提高团队成员的工作绩效和职业发展能力。" },
    { id: 14068, title: "内部知识库与资源分享", desc: "构建一个完善的内部知识库与资源分享体系，促进团队成员之间的知识共享和协作。" },
    { id: 14069, title: "会议纪要与行动计划", desc: "撰写详细、准确的会议纪要，并制定具有可操作性的行动计划，以推动私域运营工作的顺利进行。" },
    { id: 14070, title: "团队成员成长路径规划", desc: "制定一套科学合理的团队成员成长路径规划，提高团队整体素质和业务能力。" },
  ],
  "合规管理": [
    { id: 14071, title: "数据隐私与安全政策", desc: "制定一份全面、详细且符合法律法规要求的数据隐私与安全政策，确保私域运营中的数据得到妥善保护。" },
    { id: 14072, title: "用户信息保护措施", desc: "制定全面的用户信息保护措施，确保私域运营中的用户信息安全。" },
    { id: 14073, title: "法规遵循与行业标准", desc: "撰写一份详细的《法规遵循与行业标准》文档，为私域运营提供明确的指导。" },
    { id: 14074, title: "内部审计与合规检查报告", desc: "撰写一份详细、准确的《内部审计与合规检查报告》，为私域运营提供改进建议和决策依据。" },
    { id: 14075, title: "风险识别与应对策略", desc: "撰写一份全面的《私域运营风险识别与应对策略》，为企业的私域运营提供指导，降低风险，提高运营效果。" },
    { id: 14076, title: "用户协议与服务条款更新", desc: "撰写一份全面、准确、合法的用户协议与服务条款更新内容，确保用户权益得到充分保障，同时平台运营符合相关法律法规和政策要求。" },
    { id: 14077, title: "侵权与版权注意事项", desc: "撰写一份详细的《侵权与版权注意事项》，为私域运营者提供指导。" },
    { id: 14078, title: "紧急情况应对指南", desc: "制定一份全面的《紧急情况应对指南》，帮助私域运营团队在面对紧急情况时能够迅速、有效地采取行动，降低损失，维护用户信任和品牌形象。" },
    { id: 14079, title: "举报与投诉处理程序", desc: "制定一套完善的举报与投诉处理程序，确保举报与投诉能够得到及时、有效的处理，提高用户满意度。" },
    { id: 14080, title: "法律顾问咨询记录", desc: "撰写一份完整、准确的法律顾问咨询记录，为私域运营提供法律支持和参考。" },
  ],
};

// 生成API路由文件内容
function generateApiRoute(template, categoryName) {
  return `import { NextRequest, NextResponse } from "next/server";

// 系统提示词 - ${categoryName}: ${template.title}
const SYSTEM_PROMPT = \`# Role: 私域运营专家 - ${template.title}

## Profile
- **Author**: 妙动AI
- **Version**: 1.0
- **Language**: 中文
- **Description**: 专注于私域运营领域的资深专家，拥有丰富的实战经验和深厚的理论基础。擅长${categoryName}相关的策略制定和执行。

## Background
在私域运营中，${template.title}是提升用户价值和运营效果的关键环节。用户需要专业的指导来${template.desc}

## Goals
1. **深入理解需求**：通过询问，精准识别用户的具体需求和目标。
2. **提供专业方案**：基于最佳实践，输出详细、可执行的${template.title}方案。
3. **注重实操性**：确保所有建议都具有可操作性和实用价值。
4. **持续优化**：根据反馈不断完善方案，确保达到最佳效果。

## Constrains
1. **专业性**：所有建议必须基于私域运营的最佳实践和行业标准。
2. **可操作性**：提供的方案必须具体、可执行，避免空泛的理论。
3. **合规性**：确保所有建议符合相关法律法规和平台规则。
4. **用户导向**：始终以用户价值和体验为核心考量。

## Skills
1. **私域运营策略**：精通私域流量运营的各个环节和策略。
2. **${categoryName}专长**：深入理解${categoryName}的方法论和最佳实践。
3. **数据分析能力**：善于通过数据分析优化运营策略。
4. **内容创作**：具备优秀的文案创作和内容策划能力。
5. **工具应用**：熟练运用各类私域运营工具和平台。

## Rules
1. **先问后答**：在给出方案前，通过3-5个关键问题了解用户的具体情况。
2. **结构化输出**：方案应包含背景分析、策略建议、执行步骤、预期效果等部分。
3. **案例支撑**：适当引用成功案例来支撑建议的有效性。
4. **风险提示**：主动指出可能存在的风险和注意事项。

## Workflow
1. **需求探询**：了解用户的行业、目标、现状和具体需求。
2. **现状分析**：分析当前情况，识别问题和机会点。
3. **方案制定**：
   - 核心策略
   - 具体措施
   - 执行步骤
   - 资源需求
4. **效果预估**：说明预期效果和关键指标。
5. **优化建议**：提供持续优化的方向和方法。

## Initialization
作为角色 <Role>, 严格遵守 <Rules>, 使用默认 <Language> 与用户对话。

首先，用专业、友好的语气欢迎用户，简要介绍你在私域运营${categoryName}领域的专业能力。

然后，请告诉用户你的 <Workflow>，并提出3-5个关键问题，以便深入了解用户的具体需求。
\`;

export async function POST(request: NextRequest) {
  try {
    const { messages } = await request.json();

    // 构建完整的消息历史
    const fullMessages = [
      { role: "system", content: SYSTEM_PROMPT },
      ...messages
    ];

    // 调用AI API
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": process.env.ANTHROPIC_API_KEY || "",
        "anthropic-version": "2023-06-01",
      },
      body: JSON.stringify({
        model: "claude-3-5-sonnet-20241022",
        max_tokens: 4096,
        messages: fullMessages,
      }),
    });

    const data = await response.json();
    const result = data.content[0].text;

    return NextResponse.json({ result });
  } catch (error) {
    console.error("API Error:", error);
    return NextResponse.json(
      { error: "生成失败，请重试" },
      { status: 500 }
    );
  }
}
`;
}

// 主函数
function main() {
  const baseDir = path.join(__dirname, '..', 'app', 'api', 'private-operation');

  // 确保基础目录存在
  if (!fs.existsSync(baseDir)) {
    fs.mkdirSync(baseDir, { recursive: true });
  }

  let count = 0;

  for (const [categoryName, templates] of Object.entries(PRIVATE_OPERATION_DATA)) {
    for (const template of templates) {
      const apiDir = path.join(baseDir, template.id.toString());

      // 创建API目录
      if (!fs.existsSync(apiDir)) {
        fs.mkdirSync(apiDir, { recursive: true });
      }

      // 生成route.ts文件
      const routeContent = generateApiRoute(template, categoryName);
      fs.writeFileSync(path.join(apiDir, 'route.ts'), routeContent, 'utf-8');

      count++;
      console.log(`✅ Created API: /api/private-operation/${template.id} - ${template.title}`);
    }
  }

  console.log(`\n🎉 Successfully created ${count} API endpoints!`);
}

main();
