# 公众号文章撰写功能开发文档

## 📋 项目概述

本文档记录了为"秒懂AI超级写作员工"项目开发公众号文章撰写功能的完整过程，包括需求分析、技术实现和使用说明。

**开发时间：** 2026-01-29
**功能模块：** 公众号文章大纲生成与AI创作
**模板ID：** 109

---

## 🎯 需求分析

### 功能需求

根据系统提示词（公众号爆款文章-大纲架构师 v2.0），需要实现一个专门的表单页面，用于收集用户的文章主题，并通过AI生成符合"七步高转化逻辑框架"的文章大纲。

### 系统提示词要求

系统提示词定义了AI助手的角色和工作流程：

**角色定位：**
- 公众号爆款文章-大纲架构师 (Outline Master Pro)
- 深度拆解主题、逻辑构建、场景化痛点挖掘、实操方法论转化

**核心目标：**
1. 痛点精准化：精准描述读者在特定场景下的焦虑与需求
2. 结构标准化：严格执行"引入-定义-筹备-实操-案例-总结-资源"七步法
3. 内容落地化：每个层级必须包含具体的工具、模型（如SMART）、清单或心理建设方案

**七步高转化逻辑框架：**
1. 开头：痛点与钩子 (The Hook)
2. 核心概念：认知重塑 (What & Why)
3. 执行前奏：宏观策略 (Preparation)
4. 核心实操：微观战术 (How - Actionable Steps)
5. 案例验证：他山之石 (Proof)
6. 结尾：总结与号召 (Conclusion & CTA)
7. 延伸资源 (Bonus Resources)

**需要收集的信息：**
1. 📝 文章主题（用户想要撰写的公众号文章主题）
2. 💡 追问/补充要求（可选，用于用户对生成的大纲不满意时继续提问修改）

---

## 🏗️ 技术架构

### 前端技术栈

- **框架：** Next.js 16.0.10 (App Router)
- **UI组件：** shadcn/ui
- **语言：** TypeScript
- **样式：** Tailwind CSS

### 后端技术栈

- **API框架：** Next.js API Routes
- **AI服务：** DeepSeek API
- **环境变量管理：** .env.local

### 文件结构

```
components/
  └── xiaohongshu-writing-page.tsx    # 主页面组件（包含公众号文章表单）
app/
  └── api/
      └── official-account-article/
          └── route.ts                 # 公众号文章API路由
docs/
  └── 公众号文章撰写功能开发文档.md   # 本文档
.env.local                             # 环境变量配置
```

---

## 💻 实现过程

### 第一阶段：API路由创建

#### 1. 创建API端点

在 `app/api/official-account-article/route.ts` 中创建专用API：

```typescript
// DeepSeek API 配置
const DEEPSEEK_API_KEY = process.env.DEEPSEEK_API_KEY;
const DEEPSEEK_API_URL = process.env.DEEPSEEK_API_URL || "https://api.deepseek.com/v1/chat/completions";

// 系统提示词（完整的公众号爆款文章-大纲架构师提示词）
const SYSTEM_PROMPT = `# Role: 公众号爆款文章-大纲架构师 (Outline Master Pro)
...
`;

// 请求数据接口
interface OfficialAccountArticleRequest {
  content: string; // 用户输入的文章主题
  followUpQuestion?: string; // 可选的追问内容
}
```

#### 2. 实现API处理逻辑

```typescript
export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { content, followUpQuestion }: OfficialAccountArticleRequest = body;

    // 验证必填字段
    if (!content || typeof content !== "string" || content.trim().length === 0) {
      return NextResponse.json(
        { error: "请输入您想要撰写的文章主题" },
        { status: 400 }
      );
    }

    // 构建用户消息
    let userMessage = content;
    if (followUpQuestion) {
      userMessage += `\n\n追加要求：${followUpQuestion}`;
    }

    // 调用DeepSeek API
    const response = await fetch(DEEPSEEK_API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${DEEPSEEK_API_KEY}`,
      },
      body: JSON.stringify({
        model: "deepseek-chat",
        messages: [
          { role: "system", content: SYSTEM_PROMPT },
          { role: "user", content: userMessage },
        ],
        temperature: 0.8,
        max_tokens: 4000,
      }),
      signal: controller.signal,
    });

    // 处理响应...
  } catch (error) {
    // 错误处理...
  }
}
```

### 第二阶段：前端表单设计

#### 1. 添加表单状态变量

在 `xiaohongshu-writing-page.tsx` 中添加公众号文章专用的状态：

```typescript
// 公众号文章专用表单状态
const [articleTheme, setArticleTheme] = useState(""); // 文章主题
const [articleFollowUp, setArticleFollowUp] = useState(""); // 追问/补充要求（可选）
```

#### 2. 实现表单UI

根据模板ID（109）条件渲染专用表单：

```typescript
{templateId === "109" ? (
  <>
    {/* 文章主题 */}
    <div>
      <label className="text-sm font-medium text-foreground mb-2 flex items-center">
        📝 文章主题
      </label>
      <Input
        placeholder="例如：如何从零开始养成早起习惯、职场新人如何高效复盘..."
        value={articleTheme}
        onChange={(e) => setArticleTheme(e.target.value)}
      />
    </div>

    {/* 追问/补充要求（可选） */}
    <div>
      <label className="text-sm font-medium text-foreground mb-2 flex items-center">
        💡 追问/补充要求（可选）
      </label>
      <Textarea
        placeholder="如果你对生成的大纲有特殊要求，可以在这里补充说明..."
        className="min-h-[100px] resize-none"
        value={articleFollowUp}
        onChange={(e) => setArticleFollowUp(e.target.value)}
      />
    </div>

    {/* 继续提问提示 */}
    <div className="bg-blue-50 dark:bg-blue-950/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
      <p className="text-sm text-blue-700 dark:text-blue-300 leading-relaxed">
        💬 <strong>提示：</strong>生成大纲后，你可以在下方继续提问修改，比如：
        <br />• "能不能针对第4部分补充更多具体步骤？"
        <br />• "可以增加一些心理学原理的解释吗？"
        <br />• "能不能提供更多实用工具推荐？"
        <br />• "案例部分能不能更详细一些？"
      </p>
    </div>
  </>
) : (
  // 其他模板的通用表单
  ...
)}
```

### 第三阶段：表单验证与数据处理

#### 1. 添加表单验证逻辑

```typescript
if (templateId === "109") {
  // 公众号文章表单验证（所有字段都是可选的，用户根据需求填选）
  // 不进行必填验证，但至少需要有文章主题
  if (!articleTheme.trim()) {
    setError("请输入文章主题");
    return;
  }
}
```

#### 2. API调用逻辑

```typescript
if (templateId === "109") {
  // 公众号文章专用API
  apiEndpoint = "/api/official-account-article";
  // 构建请求体，包含文章主题和可选的追问
  requestBody = {
    content: articleTheme,
    followUpQuestion: articleFollowUp || undefined
  };
}
```

#### 3. 历史记录格式化

```typescript
const contentForHistory = templateId === "109"
  ? `${articleTheme}${articleFollowUp ? " | 追问: " + articleFollowUp.substring(0, 20) + "..." : ""}`
  : contentInput;
```

### 第四阶段：UI优化

#### 1. 自定义欢迎文本

```typescript
{templateId === "109"
  ? "📝 你好！我是公众号爆款文章-大纲架构师！我擅长深度拆解主题、逻辑构建、场景化痛点挖掘和实操方法论转化。基于经过验证的'七步高转化逻辑框架'，我将为你生成逻辑严密、读者粘性强且具有高度可执行性的文章大纲。准备好打造高质量公众号文章了吗？✨"
  : ...
}
```

---

## 📦 环境配置

### .env.local 配置

```bash
# DeepSeek API 配置
DEEPSEEK_API_KEY=sk-3911af2ade114c229a46cb6fd1c434f4
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions

# 历史记录存储方式
# 本地测试：false 或不设置（使用 localStorage）
# 生产环境：true（使用数据库）
NEXT_PUBLIC_USE_DATABASE=false
```

---

## 🚀 部署与测试

### 本地开发

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问地址
http://localhost:3000/writing/xiaohongshu?template=109&title=公众号文章撰写
```

### 构建生产版本

```bash
# 构建项目
npm run build

# 启动生产服务器
npm start
```

### 测试步骤

1. **访问页面**
   - 导航到公众号文章撰写页面
   - URL参数：`template=109&title=公众号文章撰写`

2. **填写表单**
   - 文章主题：如何从零开始养成早起习惯
   - 追问/补充要求：（可选）需要更多实用工具推荐

3. **提交生成**
   - 点击"智能创作"按钮
   - 等待AI生成结果（约10-20秒）

4. **验证结果**
   - 检查生成的大纲是否符合七步框架
   - 验证是否包含痛点、实操步骤、案例等元素
   - 确认历史记录是否正确保存

5. **继续提问测试**
   - 在生成结果后，在追问框中输入修改要求
   - 再次点击"智能创作"
   - 验证AI是否根据追问进行了调整

---

## 🎨 UI设计说明

### 表单布局

- **布局方式：** 垂直堆叠，单列布局
- **间距：** 使用 `space-y-4` 统一间距
- **标签样式：** 带emoji图标，清晰易读
- **输入框：** 使用 shadcn/ui 的 Input 和 Textarea 组件
- **提示文本：** 使用 placeholder 提供输入示例

### 视觉风格

- **主色调：** 保持与整体应用一致
- **表单元素：** 圆角、边框、阴影效果
- **提示区域：** 蓝色背景，突出显示继续提问的提示
- **错误提示：** 红色背景，清晰的错误信息
- **加载状态：** 旋转图标 + 提示文本

### 响应式设计

- **桌面端：** 60%表单区 + 40%结果区
- **移动端：** 全宽布局，结果区下移

---

## 📊 功能特点

### 1. 无必填字段设计

根据用户要求，所有表单字段都是可选的，用户可以根据需求填选：
- 文章主题：虽然标记为必填，但这是功能的最基本要求
- 追问/补充要求：完全可选，用于迭代优化

### 2. 继续提问功能

在表单中提供了"追问/补充要求"字段，用户可以：
- 在首次生成时就提出特殊要求
- 在生成结果后继续提问修改
- 多次迭代优化，直到满意为止

### 3. 智能提示

在表单底部提供了蓝色提示框，给用户提供继续提问的示例：
- "能不能针对第4部分补充更多具体步骤？"
- "可以增加一些心理学原理的解释吗？"
- "能不能提供更多实用工具推荐？"
- "案例部分能不能更详细一些？"

---

## 🔒 安全考虑

### API密钥管理

- ✅ 使用环境变量存储API密钥
- ✅ .env.local 文件不提交到Git仓库
- ✅ 生产环境使用独立的API密钥

### 输入验证

- ✅ 前端表单验证
- ✅ 后端参数验证
- ✅ 防止SQL注入和XSS攻击

### 错误处理

- ✅ 不暴露敏感的错误信息
- ✅ 记录详细的服务器日志
- ✅ 用户友好的错误提示

---

## 📚 相关文档

### 系统提示词

完整的系统提示词定义了AI助手的角色、技能、规则和工作流程，存储在：
- `app/api/official-account-article/route.ts` 的 `SYSTEM_PROMPT` 常量中

### API文档

- **端点：** `/api/official-account-article`
- **方法：** POST
- **请求体：**
  ```json
  {
    "content": "如何从零开始养成早起习惯",
    "followUpQuestion": "需要更多实用工具推荐"
  }
  ```
- **响应体：**
  ```json
  {
    "success": true,
    "result": "生成的文章大纲内容...",
    "usage": {
      "prompt_tokens": 100,
      "completion_tokens": 500,
      "total_tokens": 600
    }
  }
  ```

---

## 🎯 使用场景

### 适用人群

1. **公众号运营者**：需要高质量文章大纲的内容创作者
2. **自媒体作者**：希望提升文章逻辑性和可读性的写作者
3. **企业新媒体团队**：需要批量生产高质量内容的团队
4. **个人博主**：想要提升写作水平的个人创作者

### 典型使用流程

1. **确定主题**：明确想要撰写的文章主题
2. **填写表单**：输入文章主题，可选填补充要求
3. **生成大纲**：AI根据七步框架生成详细大纲
4. **迭代优化**：通过追问功能不断完善大纲
5. **开始写作**：基于大纲进行文章创作

---

## 🎯 未来优化方向

### 功能增强

1. **模板库**：提供多种文章类型的模板（干货、故事、观点等）
2. **大纲导出**：支持导出为Markdown、Word等格式
3. **协作功能**：支持团队协作编辑大纲
4. **AI续写**：基于大纲直接生成完整文章

### 用户体验

1. **实时预览**：边填写边预览大纲结构
2. **智能推荐**：根据主题推荐相关案例和工具
3. **历史记录增强**：更强大的历史记录管理和搜索
4. **分享功能**：一键分享大纲给团队成员

### 技术优化

1. **缓存机制**：缓存常见主题的生成结果
2. **流式输出**：使用SSE实现实时生成
3. **并发控制**：限制同时生成的请求数量
4. **监控告警**：添加性能监控和错误告警

---

## 👥 开发团队

- **开发者：** Claude Sonnet 4.5
- **项目负责人：** [用户名]
- **开发时间：** 2026-01-29

---

## 📄 许可证

本项目遵循项目整体的许可证协议。

---

## 🙏 致谢

感谢以下技术和服务的支持：
- Next.js 团队
- shadcn/ui 组件库
- DeepSeek AI 服务
- Vercel 部署平台

---

**文档版本：** 1.0
**最后更新：** 2026-01-29
**维护者：** 开发团队
