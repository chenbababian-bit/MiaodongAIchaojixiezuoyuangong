# 小红书风格排版功能开发文档

## 📋 项目概述

本文档记录了为"秒懂AI超级写作员工"项目开发小红书风格排版功能的完整过程，包括需求分析、技术实现和部署说明。

**开发时间：** 2026-01-29
**功能模块：** 小红书风格排版表单收集与AI生成
**模板ID：** 106

---

## 🎯 需求分析

### 功能需求

根据系统提示词（小红书爆款内容操盘手 v2.0），需要实现一个专门的表单页面，用于收集用户的内容信息，并通过AI生成符合小红书风格的排版文案。

### 系统提示词要求

系统提示词定义了AI助手的角色和工作流程：

**角色定位：**
- 小红书爆款内容操盘手
- 精通流量算法研究、视觉排版美学、爆款文案心理学、SEO关键词布局

**核心目标：**
1. 黄金三秒完读：通过视觉引导和情绪钩子，确保读者在前3秒不划走
2. 精准SEO布局：在标题、首段和标签中自然植入核心关键词，提升搜索排名
3. 情绪共鸣/价值交付：根据赛道不同，提供极致的情绪价值或实用价值
4. 互动率最大化：通过话术引导点赞、收藏和评论

**需要收集的信息：**
1. 📝 主题/核心卖点
2. 🎯 目标受众
3. 🎨 期望风格（闺蜜夜话风/清醒大女主风/硬核极客风/发疯文学风）
4. 📄 草稿内容（可选）
5. 💡 补充说明（可选）

---

## 🏗️ 技术架构

### 前端技术栈

- **框架：** Next.js 16.0.10 (App Router)
- **UI组件：** shadcn/ui
- **语言：** TypeScript
- **样式：** Tailwind CSS

### 后端技术栈

- **API框架：** Next.js API Routes
- **AI服务：** DeepSeek API
- **环境变量管理：** .env.local

### 文件结构

```
components/
  └── xiaohongshu-writing-page.tsx    # 主页面组件
app/
  └── api/
      └── xiaohongshu-style/
          └── route.ts                 # API路由
.env.local                             # 环境变量配置
```

---

## 💻 实现过程

### 第一阶段：表单设计与状态管理

#### 1. 添加表单状态变量

在 `xiaohongshu-writing-page.tsx` 中添加小红书风格排版专用的状态：

```typescript
// 小红书风格排版专用表单状态
const [styleTheme, setStyleTheme] = useState(""); // 主题/核心卖点
const [styleAudience, setStyleAudience] = useState(""); // 目标受众
const [styleType, setStyleType] = useState(""); // 期望风格
const [styleDraft, setStyleDraft] = useState(""); // 草稿内容（可选）
```

#### 2. 实现表单UI

根据模板ID（106）条件渲染专用表单：

```typescript
{templateId === "106" ? (
  <>
    {/* 主题/核心卖点 */}
    <Input
      placeholder="例如：AI效率工具、秋季穿搭、护肤routine..."
      value={styleTheme}
      onChange={(e) => setStyleTheme(e.target.value)}
    />

    {/* 目标受众 */}
    <Input
      placeholder="例如：25-35岁都市女性、设计师群体、大学生..."
      value={styleAudience}
      onChange={(e) => setStyleAudience(e.target.value)}
    />

    {/* 期望风格 */}
    <Select value={styleType} onValueChange={setStyleType}>
      <SelectItem value="girlfriend">闺蜜夜话风（软萌亲切，适合美妆/情感）</SelectItem>
      <SelectItem value="boss">清醒大女主风（犀利金句，适合职场/成长）</SelectItem>
      <SelectItem value="geek">硬核极客风（参数对比，适合数码/家电）</SelectItem>
      <SelectItem value="crazy">发疯文学风（情绪夸张，适合吐槽/搞笑）</SelectItem>
    </Select>

    {/* 草稿内容（可选） */}
    <Textarea
      placeholder="如果你已经有初稿，可以粘贴在这里，我来帮你优化排版和风格..."
      value={styleDraft}
      onChange={(e) => setStyleDraft(e.target.value)}
    />

    {/* 补充说明（可选） */}
    <Textarea
      placeholder="还有其他想补充的信息吗？比如特殊要求、参考案例等..."
      value={contentInput}
      onChange={(e) => setContentInput(e.target.value)}
    />
  </>
) : (
  // 其他模板的通用表单
  ...
)}
```

### 第二阶段：表单验证与数据处理

#### 1. 添加表单验证逻辑

```typescript
if (templateId === "106") {
  // 小红书风格排版表单验证
  if (!styleTheme.trim()) {
    setError("请输入主题/核心卖点");
    return;
  }
  if (!styleAudience.trim()) {
    setError("请输入目标受众");
    return;
  }
  if (!styleType) {
    setError("请选择期望风格");
    return;
  }
}
```

#### 2. 格式化表单数据

将表单数据组合成结构化的描述文本：

```typescript
const styleTypeMap: Record<string, string> = {
  "girlfriend": "闺蜜夜话风",
  "boss": "清醒大女主风",
  "geek": "硬核极客风",
  "crazy": "发疯文学风"
};

const styleInfo = `📝 主题/核心卖点：${styleTheme}
🎯 目标受众：${styleAudience}
🎨 期望风格：${styleTypeMap[styleType] || styleType}
${styleDraft ? `\n草稿内容：\n${styleDraft}\n` : ""}${contentInput ? `\n补充说明：${contentInput}` : ""}`;
```

### 第三阶段：API集成

#### 1. 创建API端点

创建 `/api/xiaohongshu-style/route.ts` 文件，使用完整的系统提示词：

```typescript
const SYSTEM_PROMPT = `# Role: 小红书爆款内容操盘手 (Viral Content Operator)

## Profile:
- Author: 呱呱
- Version: 2.0 (Pro)
- Language: 中文
- Expertise: 流量算法研究、视觉排版美学、爆款文案心理学、SEO关键词布局

...（完整的系统提示词）
`;
```

#### 2. 修改API调用逻辑

```typescript
if (templateId === "106") {
  apiEndpoint = "/api/xiaohongshu-style";
  requestBody = { content: styleInfo };
}
```

### 第四阶段：UI优化

#### 1. 自定义欢迎文本

```typescript
{templateId === "106"
  ? "🚀 哈喽！我是你的小红书爆款内容操盘手！别让你的好内容被埋没！不管是干货种草🌱、情绪宣泄💢还是硬核科普🧠，我都能帮你把流量拿捏得死死的。我精通流量算法、视觉排版美学、爆款文案心理学和SEO关键词布局。准备好打造爆款笔记了吗？✨"
  : `欢迎来到${templateTitle}创作空间！...`
}
```

#### 2. 历史记录格式优化

```typescript
const contentForHistory = templateId === "106"
  ? `${styleTheme} | ${styleAudience} | ${styleType}`
  : contentInput;
```

---

## 📦 环境配置

### .env.local 配置

```bash
# DeepSeek API 配置
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions

# 历史记录存储方式
# 本地测试：false 或不设置（使用 localStorage）
# 生产环境：true（使用数据库）
NEXT_PUBLIC_USE_DATABASE=false
```

---

## 🚀 部署与测试

### 本地开发

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问地址
http://localhost:3000/writing/xiaohongshu?template=106&title=小红书风格排版&source=media-xiaohongshu
```

### 构建生产版本

```bash
# 构建项目
npm run build

# 启动生产服务器
npm start
```

### 测试步骤

1. **访问页面**
   - 导航到小红书风格排版页面

2. **填写表单**
   - 主题/核心卖点：AI效率工具
   - 目标受众：设计师群体
   - 期望风格：清醒大女主风
   - 草稿内容：（可选）粘贴初稿

3. **提交生成**
   - 点击"智能创作"按钮
   - 等待AI生成结果（约10-20秒）

4. **验证结果**
   - 检查生成的文案是否符合小红书风格
   - 验证是否包含5个标题、正文、标签等元素
   - 确认历史记录是否正确保存

---

## 📝 Git提交记录

### 提交：功能实现

```bash
feat: 添加小红书风格排版功能

- 创建 /api/xiaohongshu-style API端点，集成完整的系统提示词
- 添加小红书风格排版专用表单字段（主题/核心卖点、目标受众、期望风格、草稿内容）
- 实现表单数据验证和格式化
- 支持4种风格切换：闺蜜夜话风、清醒大女主风、硬核极客风、发疯文学风
- 添加专用欢迎文本和历史记录格式化
- 支持可选的草稿内容和补充说明字段

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**提交哈希：** 619c4b4

---

## 🎨 UI设计说明

### 表单布局

- **布局方式：** 垂直堆叠，单列布局
- **间距：** 使用 `space-y-4` 统一间距
- **标签样式：** 带红色星号标记必填字段
- **输入框：** 使用 shadcn/ui 的 Input、Select 和 Textarea 组件
- **提示文本：** 使用 placeholder 提供输入示例

### 视觉风格

- **主色调：** 保持与整体应用一致
- **表单元素：** 圆角、边框、阴影效果
- **错误提示：** 红色背景，清晰的错误信息
- **加载状态：** 旋转图标 + 提示文本

### 响应式设计

- **桌面端：** 60%表单区 + 40%结果区
- **移动端：** 全宽布局，结果区下移

---

## 📊 性能优化

### 前端优化

1. **状态管理：** 使用 React Hooks 管理表单状态
2. **条件渲染：** 根据模板ID按需渲染组件
3. **错误边界：** 完善的错误处理和用户提示

### 后端优化

1. **超时控制：** API请求设置55秒超时
2. **错误处理：** 完整的try-catch错误捕获
3. **响应格式：** 统一的JSON响应格式

---

## 🔒 安全考虑

### API密钥管理

- ✅ 使用环境变量存储API密钥
- ✅ .env.local 文件不提交到Git仓库
- ✅ 生产环境使用独立的API密钥

### 输入验证

- ✅ 前端表单验证
- ✅ 后端参数验证
- ✅ 防止SQL注入和XSS攻击

### 错误处理

- ✅ 不暴露敏感的错误信息
- ✅ 记录详细的服务器日志
- ✅ 用户友好的错误提示

---

## 📚 相关文档

### 系统提示词

完整的系统提示词定义了AI助手的角色、技能、规则和工作流程，存储在：
- `app/api/xiaohongshu-style/route.ts` 的 `SYSTEM_PROMPT` 常量中

### API文档

- **端点：** `/api/xiaohongshu-style`
- **方法：** POST
- **请求体：**
  ```json
  {
    "content": "📝 主题/核心卖点：AI效率工具\n🎯 目标受众：设计师群体\n🎨 期望风格：清醒大女主风"
  }
  ```
- **响应体：**
  ```json
  {
    "success": true,
    "result": "生成的文案内容...",
    "usage": {
      "prompt_tokens": 100,
      "completion_tokens": 500,
      "total_tokens": 600
    }
  }
  ```

---

## 🎯 功能特点

### 多维风格切换引擎

1. **闺蜜夜话风**
   - 软萌、亲切、大量叠词、颜文字
   - 适合美妆/情感类内容

2. **清醒大女主风**
   - 犀利、短句、反问句、金句频出
   - 适合职场/成长类内容

3. **硬核极客风**
   - 参数对比、符号化（✅ 🆚 ❌）、客观冷静
   - 适合数码/家电类内容

4. **发疯文学风**
   - 情绪夸张、感叹号连用！！！、无厘头
   - 适合吐槽/搞笑类内容

### 排版美学算法

- **三明治排版法**：开头Hook + 中间Content + 结尾CTA
- **列表清单法**：使用Emoji + 小标题的形式
- **对比排版法**：使用符号化对比展示

### 爆款标题工坊

- 📌 [痛点+救赎]：直击问题并给出方案
- 🔢 [数字+结果]：量化价值
- 🔥 [情绪+共鸣]：激发好奇或焦虑
- 🏷️ [人群+场景]：圈定特定受众
- 💣 [反差+悬念]：颠覆认知

---

## 🎯 未来优化方向

### 功能增强

1. **风格预览：** 实时预览不同风格的效果
2. **模板库：** 提供多种行业的文案模板
3. **批量生成：** 一次生成多个版本供选择
4. **智能推荐：** 根据主题推荐最适合的风格

### 用户体验

1. **实时预览：** 边填写边预览效果
2. **智能提示：** 根据输入内容提供优化建议
3. **历史记录：** 更强大的历史记录管理
4. **分享功能：** 一键分享到小红书

### 技术优化

1. **缓存机制：** 缓存常见主题的生成结果
2. **流式输出：** 使用SSE实现实时生成
3. **并发控制：** 限制同时生成的请求数量
4. **监控告警：** 添加性能监控和错误告警

---

## 👥 开发团队

- **开发者：** Claude Sonnet 4.5
- **项目负责人：** [用户名]
- **开发时间：** 2026-01-29

---

## 📄 许可证

本项目遵循项目整体的许可证协议。

---

## 🙏 致谢

感谢以下技术和服务的支持：
- Next.js 团队
- shadcn/ui 组件库
- DeepSeek AI 服务
- Vercel 部署平台

---

**文档版本：** 1.0
**最后更新：** 2026-01-29
**维护者：** 开发团队
