# 模板统一配置测试文档

## 测试目标
验证同名模板统一配置功能的正确性和向后兼容性。

## 测试环境
- 项目：MiaodongAIxiezuoweb
- 分支：main
- 测试日期：2026-01-30

## 测试用例

### 1. ID映射功能测试

#### 1.1 小红书爆款文案（ID: 1 → 102）
**测试步骤：**
1. 访问旧URL：`/writing/xiaohongshu?template=1&title=小红书爆款文案`
2. 观察是否自动重定向到：`/writing/xiaohongshu?template=102&title=小红书爆款文案`
3. 检查控制台是否有警告信息

**预期结果：**
- ✅ 自动重定向到新ID
- ✅ 控制台显示：`Legacy ID 1 detected, redirecting to canonical ID 102`
- ✅ 页面功能正常

#### 1.2 公众号文章撰写（ID: 3, 109, 204 → 201）
**测试步骤：**
1. 测试旧ID 3：`/writing/xiaohongshu?template=3&title=公众号文章撰写`
2. 测试旧ID 109：`/writing/xiaohongshu?template=109&title=公众号文章撰写`
3. 测试旧ID 204：`/writing/xiaohongshu?template=204&title=公众号文章撰写`
4. 观察是否都重定向到：`/writing/wechat?template=201&title=公众号文章撰写`

**预期结果：**
- ✅ 所有旧ID都重定向到新ID 201
- ✅ 路由正确（/writing/wechat而非/writing/xiaohongshu）
- ✅ 控制台显示相应警告信息

#### 1.3 小红书爆款标题（ID: 6 → 103）
**测试步骤：**
1. 访问旧URL：`/writing/xiaohongshu?template=6&title=小红书爆款标题`
2. 观察是否自动重定向到：`/writing/xiaohongshu?template=103&title=小红书爆款标题`

**预期结果：**
- ✅ 自动重定向到新ID
- ✅ 页面功能正常

### 2. 路由配置测试

#### 2.1 小红书模板路由
**测试步骤：**
1. 从media-page点击"小红书爆款文案"（ID: 102）
2. 验证跳转到：`/writing/xiaohongshu?template=102`

**预期结果：**
- ✅ 路由正确
- ✅ 页面加载正常

#### 2.2 公众号模板路由
**测试步骤：**
1. 从media-page点击"公众号文章撰写"（ID: 201）
2. 验证跳转到：`/writing/wechat?template=201`

**预期结果：**
- ✅ 路由正确（不再错误跳转到xiaohongshu）
- ✅ 页面加载正常

### 3. API端点测试

#### 3.1 小红书爆款文案API
**测试步骤：**
1. 在写作页面输入内容
2. 点击"智能创作"
3. 验证调用的API端点

**预期结果：**
- ✅ 调用 `/api/xiaohongshu`
- ✅ 返回正确的内容

#### 3.2 公众号文章撰写API
**测试步骤：**
1. 在写作页面输入内容
2. 点击"智能创作"
3. 验证调用的API端点

**预期结果：**
- ✅ 调用 `/api/official-account-article`
- ✅ 支持对话历史功能
- ✅ 返回正确的内容

### 4. 向后兼容性测试

#### 4.1 用户书签测试
**测试场景：**
用户之前保存的书签使用旧ID

**测试步骤：**
1. 模拟用户访问旧书签URL
2. 验证是否能正常访问

**预期结果：**
- ✅ 自动重定向到新URL
- ✅ 功能正常使用

#### 4.2 分享链接测试
**测试场景：**
用户分享的链接使用旧ID

**测试步骤：**
1. 模拟访问分享链接（旧ID）
2. 验证是否能正常访问

**预期结果：**
- ✅ 自动重定向到新URL
- ✅ 功能正常使用

### 5. 配置驱动测试

#### 5.1 getTemplateById测试
**测试代码：**
```typescript
import { getTemplateById } from '@/lib/template-config';

// 测试直接ID
const template102 = getTemplateById(102);
console.log(template102?.title); // 应该输出：小红书爆款文案

// 测试legacyId
const template1 = getTemplateById(1);
console.log(template1?.id); // 应该输出：102
console.log(template1?.title); // 应该输出：小红书爆款文案
```

**预期结果：**
- ✅ 直接ID查找成功
- ✅ legacyId查找成功并返回正确的模板

#### 5.2 getCanonicalId测试
**测试代码：**
```typescript
import { getCanonicalId } from '@/lib/template-config';

console.log(getCanonicalId(1));   // 应该输出：102
console.log(getCanonicalId(3));   // 应该输出：201
console.log(getCanonicalId(109)); // 应该输出：201
console.log(getCanonicalId(102)); // 应该输出：102（已经是规范ID）
```

**预期结果：**
- ✅ 旧ID正确转换为新ID
- ✅ 新ID保持不变

### 6. 功能完整性测试

#### 6.1 模板列表显示
**测试步骤：**
1. 访问media-page
2. 检查所有模板是否正常显示

**预期结果：**
- ✅ 所有模板卡片正常显示
- ✅ 图标、标题、描述正确

#### 6.2 模板点击跳转
**测试步骤：**
1. 依次点击不同分类的模板
2. 验证跳转是否正确

**预期结果：**
- ✅ 小红书模板跳转到 /writing/xiaohongshu
- ✅ 公众号模板跳转到 /writing/wechat
- ✅ 其他模板跳转到对应路由

#### 6.3 表单提交功能
**测试步骤：**
1. 在写作页面填写表单
2. 点击"智能创作"
3. 验证是否正常生成内容

**预期结果：**
- ✅ 表单验证正常
- ✅ API调用成功
- ✅ 内容正常生成

## 测试结果汇总

### 通过的测试
- [ ] ID映射功能
- [ ] 路由配置
- [ ] API端点调用
- [ ] 向后兼容性
- [ ] 配置驱动功能
- [ ] 功能完整性

### 发现的问题
（待测试后填写）

### 待优化项
1. 完全消除xiaohongshu-writing-page.tsx中的硬编码ID判断
2. 创建动态表单组件，基于customFields配置渲染
3. 统一所有写作页面组件

## 测试建议

### 手动测试
1. 在浏览器中逐一测试所有旧ID的URL
2. 验证控制台警告信息
3. 测试表单提交和内容生成

### 自动化测试
建议添加单元测试：
```typescript
// lib/__tests__/template-config.test.ts
describe('Template Config', () => {
  test('getTemplateById with legacy ID', () => {
    const template = getTemplateById(1);
    expect(template?.id).toBe(102);
  });

  test('getCanonicalId', () => {
    expect(getCanonicalId(1)).toBe(102);
    expect(getCanonicalId(3)).toBe(201);
  });
});
```

## 测试签名

- 测试人员：_____________
- 测试日期：_____________
- 测试结果：_____________
