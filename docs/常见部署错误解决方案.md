# 常见部署错误解决方案

## TypeScript类型错误 - 对话类型不匹配

### 问题描述
在创建新的写作模块时，如果在组件内部定义了`getConversationType`函数来映射模板ID到对话类型，可能会导致TypeScript类型错误和部署失败。

### 出现次数
- 第1次：抖音运营模块 (commit: 756f1de)
- 第2次：数据分析模块 (commit: 87479b7)

### 错误原因
1. **类型定义不一致**：组件内部定义的类型名称与`lib/conversations.ts`中定义的类型不匹配
   - 错误示例：使用下划线 `data_analysis_video_play`
   - 正确示例：使用连字符 `data-analysis-video-play`

2. **重复定义**：在组件内部重新定义了类型映射函数，而`lib/conversations.ts`中已经有统一的类型映射函数

### 解决方案

#### 步骤1：导入统一的类型映射函数
在组件文件中导入对应的类型映射函数：

```typescript
// 错误 ❌
import {
  createConversation,
  getConversations,
  addMessage,
  type Conversation as DBConversation,
} from "@/lib/conversations";

// 正确 ✅
import {
  createConversation,
  getConversations,
  addMessage,
  getDataAnalysisTypeByTemplateId,  // 添加类型映射函数
  type Conversation as DBConversation,
} from "@/lib/conversations";
```

#### 步骤2：删除组件内部的类型映射函数
删除组件内部定义的`getConversationType`函数：

```typescript
// 删除这段代码 ❌
const getConversationType = (templateId: number): string => {
  switch (templateId) {
    case 5001: return "data_analysis_video_play";  // 错误的类型名称
    // ...
  }
};
```

#### 步骤3：使用导入的类型映射函数
在所有使用`getConversationType`的地方，替换为导入的函数：

```typescript
// 错误 ❌
const conversationType = getConversationType(parseInt(templateId));

// 正确 ✅
const conversationType = getDataAnalysisTypeByTemplateId(parseInt(templateId));
```

### 可用的类型映射函数

根据不同的模块，使用对应的类型映射函数：

| 模块 | 函数名 | 文件位置 |
|------|--------|----------|
| 小红书 | `getXiaohongshuTypeByTemplateId` | `lib/conversations.ts` |
| 抖音 | `getDouyinTypeByTemplateId` | `lib/conversations.ts` |
| 快手 | `getKuaishouTypeByTemplateId` | `lib/conversations.ts` |
| 数据分析 | `getDataAnalysisTypeByTemplateId` | `lib/conversations.ts` |
| 微博 | `getWeiboTypeByTemplateId` | `lib/conversations.ts` |
| 知乎 | `getZhihuTypeByTemplateId` | `lib/conversations.ts` |
| 视频文案 | `getVideoTypeByTemplateId` | `lib/conversations.ts` |

### 预防措施

在创建新的写作模块时：

1. ✅ **优先使用统一的类型定义**：检查`lib/conversations.ts`中是否已有对应的类型映射函数
2. ✅ **遵循命名规范**：对话类型使用连字符（kebab-case），如`data-analysis-video-play`
3. ✅ **参考现有模块**：查看其他已完成的模块（如小红书、抖音）的实现方式
4. ✅ **本地测试**：在提交前运行`npm run build`确保TypeScript编译通过

### 相关提交记录

- 抖音模块修复：`756f1de fix(douyin): 修复TypeScript类型错误和导入问题`
- 数据分析模块修复：待提交

### 检查清单

创建新模块时的检查清单：

- [ ] 在`lib/conversations.ts`中添加新的类型定义（如`DataAnalysisType`）
- [ ] 在`lib/conversations.ts`中添加类型映射函数（如`getDataAnalysisTypeByTemplateId`）
- [ ] 在组件中导入类型映射函数
- [ ] 使用导入的函数而不是在组件内部定义新函数
- [ ] 确保类型名称使用连字符（kebab-case）
- [ ] 运行`npm run build`验证TypeScript编译通过
- [ ] 提交前检查是否有类似的类型错误
