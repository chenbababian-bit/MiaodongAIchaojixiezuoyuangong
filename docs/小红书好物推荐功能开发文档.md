# 小红书好物推荐功能开发文档

## 📋 项目概述

本文档记录了为"秒懂AI超级写作员工"项目开发小红书好物推荐功能的完整过程，包括需求分析、技术实现和部署说明。

**开发时间：** 2026-01-29
**功能模块：** 小红书好物推荐表单收集与AI生成
**模板ID：** 108

---

## 🎯 需求分析

### 功能需求

根据系统提示词（小红书爆款种草专家 v2.0 Pro），需要实现一个专门的表单页面，用于收集用户的产品信息，并通过AI生成符合小红书风格的好物推荐文案。

### 系统提示词要求

系统提示词定义了AI助手的角色和工作流程：

**角色定位：**
- 小红书爆款种草专家
- 深度洞察小红书社区文化，精通流量算法与用户心理
- 擅长将普通商品通过"场景化+情绪价值+干货输出"转化为高互动、高转化的爆款笔记

**核心目标：**
1. 强力吸睛：设计出点击率（CTR）极高的封面标题
2. 信任构建：通过真实体验口吻和痛点场景描述，建立KOC人设
3. 情绪共鸣：精准狙击目标受众的焦虑、向往或爽点
4. 行动转化：在结尾自然植入引导，提升收藏率和购买意向

**需要收集的信息：**
1. 📦 产品是什么？（产品名称、所属赛道、核心卖点）
2. 👥 想推给谁看？（目标人群）
3. 🎨 希望什么风格？（真诚分享/硬核测评/搞笑吐槽）

**特殊要求：**
- 所有表单字段均为可选，用户根据需求填选
- 提供继续提问的表单位置，支持迭代优化

---

## 🏗️ 技术架构

### 前端技术栈

- **框架：** Next.js 16.0.10 (App Router)
- **UI组件：** shadcn/ui
- **语言：** TypeScript
- **样式：** Tailwind CSS

### 后端技术栈

- **API框架：** Next.js API Routes
- **AI服务：** DeepSeek API
- **环境变量管理：** .env.local

### 文件结构

```
components/
  └── xiaohongshu-writing-page.tsx    # 主页面组件
app/
  └── api/
      └── product-recommendation/
          └── route.ts                 # API路由
docs/
  └── 小红书好物推荐功能开发文档.md   # 本文档
.env.local                             # 环境变量配置
```

---

## 💻 实现过程

### 第一阶段：API路由创建

#### 1. 创建API端点

在 `app/api/product-recommendation/route.ts` 中创建专用API：

```typescript
import { NextRequest, NextResponse } from "next/server";

const DEEPSEEK_API_KEY = process.env.DEEPSEEK_API_KEY;
const DEEPSEEK_API_URL = process.env.DEEPSEEK_API_URL || "https://api.deepseek.com/v1/chat/completions";

const SYSTEM_PROMPT = `# Role: 小红书爆款种草专家 (XHS Viral Copywriter)
// ... 完整的系统提示词
`;

export async function POST(request: NextRequest) {
  // API实现逻辑
}
```

#### 2. 系统提示词集成

完整集成了用户提供的系统提示词，包括：
- 角色定义和背景
- 核心目标和约束
- 技能和规则
- 工作流程
- 初始化欢迎语

### 第二阶段：表单设计与状态管理

#### 1. 添加表单状态变量

在 `xiaohongshu-writing-page.tsx` 中添加好物推荐专用的状态：

```typescript
// 好物推荐专用表单状态
const [recommendProductName, setRecommendProductName] = useState(""); // 产品名称
const [recommendProductCategory, setRecommendProductCategory] = useState(""); // 产品赛道
const [recommendProductFeatures, setRecommendProductFeatures] = useState(""); // 核心卖点
const [recommendTargetAudience, setRecommendTargetAudience] = useState(""); // 目标人群
const [recommendStyle, setRecommendStyle] = useState(""); // 期望风格
const [recommendExtraInfo, setRecommendExtraInfo] = useState(""); // 补充信息（可选）
```

#### 2. 实现表单UI

根据模板ID（108）条件渲染专用表单：

```typescript
{templateId === "108" ? (
  <>
    {/* 产品名称 */}
    <Input
      placeholder="例如：戴森吹风机、雅诗兰黛小棕瓶、iPhone 15 Pro..."
      value={recommendProductName}
      onChange={(e) => setRecommendProductName(e.target.value)}
    />

    {/* 产品赛道 */}
    <Input
      placeholder="例如：美妆、数码、家居、食品..."
      value={recommendProductCategory}
      onChange={(e) => setRecommendProductCategory(e.target.value)}
    />

    {/* 核心卖点 */}
    <Textarea
      placeholder="请列出产品最牛的优势，越细越好！"
      value={recommendProductFeatures}
      onChange={(e) => setRecommendProductFeatures(e.target.value)}
    />

    {/* 目标人群 */}
    <Input
      placeholder="例如：学生党、打工人、精致妈妈..."
      value={recommendTargetAudience}
      onChange={(e) => setRecommendTargetAudience(e.target.value)}
    />

    {/* 期望风格 */}
    <Select value={recommendStyle} onValueChange={setRecommendStyle}>
      <SelectItem value="sincere">真诚分享（像闺蜜一样唠嗑）</SelectItem>
      <SelectItem value="hardcore">硬核测评（专业大神测评）</SelectItem>
      <SelectItem value="funny">搞笑吐槽（幽默风趣）</SelectItem>
    </Select>

    {/* 补充信息（可选） */}
    <Textarea
      placeholder="还有其他想补充的信息吗？"
      value={recommendExtraInfo}
      onChange={(e) => setRecommendExtraInfo(e.target.value)}
    />

    {/* 继续提问提示 */}
    <div className="bg-blue-50 dark:bg-blue-950/20 rounded-lg p-4">
      <p className="text-sm text-blue-700 dark:text-blue-300">
        💬 <strong>提示：</strong>生成文案后，你可以在下方继续提问
      </p>
    </div>
  </>
) : (
  // 其他模板的表单
  ...
)}
```

### 第三阶段：表单验证与数据处理

#### 1. 添加表单验证逻辑（宽松验证）

```typescript
if (templateId === "108") {
  // 好物推荐表单验证（所有字段都是可选的，用户根据需求填选）
  // 不进行必填验证，但至少需要有一些基本信息
  if (!recommendProductName.trim() && !recommendProductCategory.trim() && !recommendProductFeatures.trim()) {
    setError("请至少填写产品名称、产品赛道或核心卖点中的一项");
    return;
  }
}
```

**设计理念：**
- 所有字段均为可选，用户根据需求填选
- 只要求至少填写一项基本信息即可提交
- 灵活适应不同用户的使用场景

#### 2. 格式化表单数据

将表单数据组合成结构化的描述文本：

```typescript
const styleMap: Record<string, string> = {
  "sincere": "真诚分享",
  "hardcore": "硬核测评",
  "funny": "搞笑吐槽"
};

const recommendInfo = `1. 📦 产品是什么？
${recommendProductName ? `产品名称：${recommendProductName}` : ""}${recommendProductCategory ? `\n所属赛道：${recommendProductCategory}` : ""}${recommendProductFeatures ? `\n核心卖点：${recommendProductFeatures}` : ""}

2. 👥 想推给谁看？
${recommendTargetAudience || "待补充"}

3. 🎨 希望什么风格？
${recommendStyle ? styleMap[recommendStyle] || recommendStyle : "待补充"}
${recommendExtraInfo ? `\n💡 补充信息：${recommendExtraInfo}` : ""}`;
```

### 第四阶段：API集成

#### 1. API调用逻辑

```typescript
if (templateId === "108") {
  apiEndpoint = "/api/product-recommendation";
  requestBody = { content: recommendInfo };
}
```

#### 2. 历史记录格式优化

```typescript
const contentForHistory = templateId === "108"
  ? `${recommendProductName || recommendProductCategory} | ${recommendTargetAudience || "通用"} | ${recommendStyle || "真诚分享"}`
  : contentInput;
```

### 第五阶段：UI优化

#### 1. 自定义欢迎文本

```typescript
{templateId === "108"
  ? "👋 哈喽宝子们！我是你们的小红书爆款种草专家呱呱！✨ 不管你是想推美妆神仙水🧴、硬核黑科技💻，还是家居好物🛋️，我都能帮你把草种到用户的心坎里！🌱 把信息甩给我，剩下的爆款文案交给我来搞定！💪🔥"
  : `欢迎来到${templateTitle}创作空间！...`
}
```

#### 2. 继续提问提示区域

在表单底部添加了醒目的提示区域，引导用户在生成文案后继续提问：

```typescript
<div className="bg-blue-50 dark:bg-blue-950/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
  <p className="text-sm text-blue-700 dark:text-blue-300 leading-relaxed">
    💬 <strong>提示：</strong>生成文案后，你可以在下方继续提问，比如：
    <br />• "能不能再强调一下性价比？"
    <br />• "标题能不能更吸引人一点？"
    <br />• "能不能换个风格，更活泼一些？"
    <br />• "可以多提供几个标题选择吗？"
  </p>
</div>
```

---

## 📦 环境配置

### .env.local 配置

```bash
# DeepSeek API 配置
DEEPSEEK_API_KEY=sk-3911af2ade114c229a46cb6fd1c434f4
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions

# 历史记录存储方式
# 本地测试：false 或不设置（使用 localStorage）
# 生产环境：true（使用数据库）
NEXT_PUBLIC_USE_DATABASE=false
```

---

## 🚀 部署与测试

### 本地开发

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问地址
http://localhost:3000/writing/xiaohongshu?template=108&title=小红书好物推荐&source=media-xiaohongshu
```

### 构建生产版本

```bash
# 构建项目
npm run build

# 启动生产服务器
npm start
```

### 测试步骤

1. **访问页面**
   - 导航到小红书好物推荐页面

2. **填写表单（可选填写）**
   - 产品名称：戴森吹风机
   - 所属赛道：数码家电
   - 核心卖点：超强吸力、智能温控、静音设计
   - 目标人群：精致女孩
   - 期望风格：真诚分享

3. **提交生成**
   - 点击"智能创作"按钮
   - 等待AI生成结果（约10-20秒）

4. **验证结果**
   - 检查生成的文案是否符合小红书风格
   - 验证是否包含标题、正文、标签等元素
   - 确认历史记录是否正确保存

5. **继续提问测试**
   - 在生成结果后，尝试继续提问
   - 验证AI是否能根据反馈进行优化

---

## 🎨 UI设计说明

### 表单布局

- **布局方式：** 垂直堆叠，单列布局
- **间距：** 使用 `space-y-4` 统一间距
- **标签样式：** 无必填标记，所有字段均为可选
- **输入框：** 使用 shadcn/ui 的 Input、Textarea 和 Select 组件
- **提示文本：** 使用 placeholder 提供输入示例

### 视觉风格

- **主色调：** 保持与整体应用一致
- **表单元素：** 圆角、边框、阴影效果
- **错误提示：** 红色背景，清晰的错误信息
- **加载状态：** 旋转图标 + 提示文本
- **继续提问提示：** 蓝色背景，醒目但不突兀

### 响应式设计

- **桌面端：** 60%表单区 + 40%结果区
- **移动端：** 全宽布局，结果区下移

---

## 📊 性能优化

### 前端优化

1. **状态管理：** 使用 React Hooks 管理表单状态
2. **条件渲染：** 根据模板ID按需渲染组件
3. **错误边界：** 完善的错误处理和用户提示

### 后端优化

1. **超时控制：** API请求设置合理超时
2. **错误处理：** 完整的try-catch错误捕获
3. **响应格式：** 统一的JSON响应格式

---

## 🔒 安全考虑

### API密钥管理

- ✅ 使用环境变量存储API密钥
- ✅ .env.local 文件不提交到Git仓库
- ✅ 生产环境使用独立的API密钥

### 输入验证

- ✅ 前端表单验证（宽松验证）
- ✅ 后端参数验证
- ✅ 防止SQL注入和XSS攻击

### 错误处理

- ✅ 不暴露敏感的错误信息
- ✅ 记录详细的服务器日志
- ✅ 用户友好的错误提示

---

## 📚 相关文档

### 系统提示词

完整的系统提示词定义了AI助手的角色、技能、规则和工作流程，存储在：
- `app/api/product-recommendation/route.ts` 的 `SYSTEM_PROMPT` 常量中

### API文档

- **端点：** `/api/product-recommendation`
- **方法：** POST
- **请求体：**
  ```json
  {
    "content": "1. 📦 产品是什么？\n产品名称：戴森吹风机\n所属赛道：数码家电\n核心卖点：超强吸力、智能温控、静音设计\n\n2. 👥 想推给谁看？\n精致女孩\n\n3. 🎨 希望什么风格？\n真诚分享"
  }
  ```
- **响应体：**
  ```json
  {
    "success": true,
    "result": "生成的文案内容...",
    "usage": {
      "prompt_tokens": 100,
      "completion_tokens": 500,
      "total_tokens": 600
    }
  }
  ```

---

## 🎯 功能特点

### 1. 灵活的表单设计

- **无必填字段：** 所有表单字段均为可选，用户根据需求填选
- **智能验证：** 只要求至少填写一项基本信息即可提交
- **友好提示：** 每个字段都有详细的placeholder示例

### 2. 继续提问支持

- **醒目提示区域：** 在表单底部添加了蓝色提示框
- **示例问题：** 提供了4个常见的继续提问示例
- **迭代优化：** 支持用户根据生成结果继续提问和优化

### 3. 多风格支持

- **真诚分享：** 像闺蜜一样唠嗑
- **硬核测评：** 专业大神测评
- **搞笑吐槽：** 幽默风趣

---

## 🎯 未来优化方向

### 功能增强

1. **图片上传：** 支持用户上传产品照片
2. **模板选择：** 提供多种文案风格模板
3. **批量生成：** 一次生成多个版本供选择
4. **SEO优化：** 自动生成关键词和标签

### 用户体验

1. **实时预览：** 边填写边预览效果
2. **智能推荐：** 根据产品类别推荐卖点
3. **历史记录：** 更强大的历史记录管理
4. **分享功能：** 一键分享到小红书

### 技术优化

1. **缓存机制：** 缓存常见产品的生成结果
2. **流式输出：** 使用SSE实现实时生成
3. **并发控制：** 限制同时生成的请求数量
4. **监控告警：** 添加性能监控和错误告警

---

## 👥 开发团队

- **开发者：** Claude Sonnet 4.5
- **项目负责人：** [用户名]
- **开发时间：** 2026-01-29

---

## 📄 许可证

本项目遵循项目整体的许可证协议。

---

## 🙏 致谢

感谢以下技术和服务的支持：
- Next.js 团队
- shadcn/ui 组件库
- DeepSeek AI 服务
- Vercel 部署平台

---

**文档版本：** 1.0
**最后更新：** 2026-01-29
**维护者：** 开发团队
