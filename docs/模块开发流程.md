# 模块开发流程文档

本文档记录了与营销模块、运营模块同层级的新模块开发标准流程。

## 一、模块结构概述

每个模块包含三层导航结构：
- **第一层**：主导航（如：营销、运营、公文等）
- **第二层**：横向标签页导航（如：品牌、创意、媒介等）
- **第三层**：左侧垂直导航（如：品牌战略、市场分析等）

## 二、开发步骤

### 步骤1：数据结构设计（lib/marketing-templates.ts）

#### 1.1 定义第二层分类数组
```typescript
export const [模块名]SecondLevelCategories = [
  { id: "category-1", label: "分类1", icon: "🎯" },
  { id: "category-2", label: "分类2", icon: "🎨" },
  // ... 更多分类
];
```

#### 1.2 定义第三层子分类数组（每个第二层分类对应一个）
```typescript
export const [分类名]SubCategories = [
  { id: "sub-category-1", label: "子分类1" },
  { id: "sub-category-2", label: "子分类2" },
  // ... 更多子分类
];
```

#### 1.3 定义模板数据（每个第三层子分类对应一组模板）
```typescript
export const [子分类名]Templates = [
  {
    id: 10001, // 模板ID，需要唯一
    title: "模板标题",
    desc: "模板描述",
    icon: "📝",
    color: "bg-blue-500", // Tailwind颜色类
  },
  // ... 更多模板（通常每个子分类7个模板）
];
```

**模板ID规划：**
- 营销模块：10001-19999
- 运营模块：35001-35999（增长黑客）、36001-36999（电商运营）等
- 建议为新模块预留10000个ID空间

### 步骤2：创建页面组件（components/[模块名]-page.tsx）

#### 2.1 基础结构
```typescript
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Card } from "@/components/ui/card";
import { cn } from "@/lib/utils";
import {
  // 导入所有需要的分类和模板数据
} from "@/lib/marketing-templates";

export function [模块名]Page() {
  const router = useRouter();
  const [activeSecondLevel, setActiveSecondLevel] = useState("默认分类ID");
  const [activeThirdLevel, setActiveThirdLevel] = useState("默认子分类ID");

  // ... 组件逻辑
}
```

#### 2.2 实现模板点击处理
```typescript
const handleTemplateClick = (templateId: number, templateTitle: string) => {
  const source = `[模块名]-${activeSecondLevel}-${activeThirdLevel}`;
  console.log("点击了模板卡片，ID:", templateId);
  router.push(`/writing/xiaohongshu?template=${templateId}&title=${encodeURIComponent(templateTitle)}&source=${source}`);
};
```

#### 2.3 实现滚动导航
```typescript
const scrollToCategory = (categoryId: string) => {
  const element = document.getElementById(`category-${categoryId}`);
  if (element) {
    element.scrollIntoView({ behavior: "smooth", block: "start" });
  }
  setActiveThirdLevel(categoryId);
};
```

#### 2.4 配置分类数据映射
```typescript
// 为每个第二层分类配置其子分类和模板
const [分类名]Categories = [
  { id: "sub-1", label: "子分类1", templates: sub1Templates },
  { id: "sub-2", label: "子分类2", templates: sub2Templates },
  // ...
];

// 根据分类ID获取对应的分类配置
const getCategoriesById = (categoryId: string) => {
  switch (categoryId) {
    case "category-1": return category1Categories;
    case "category-2": return category2Categories;
    // ...
    default: return [];
  }
};
```

#### 2.5 实现UI布局

**重要：卡片结构必须与营销页面完全一致！**

```typescript
return (
  <div className="flex flex-col h-[calc(100vh-56px)]">
    {/* 第二层导航 - 横向标签页 */}
    <div className="border-b border-border bg-card">
      <div className="flex items-center px-6 h-14">
        {[模块名]SecondLevelCategories.map((category) => (
          <button
            key={category.id}
            onClick={() => {
              setActiveSecondLevel(category.id);
              const categories = getCategoriesById(category.id);
              if (categories.length > 0) {
                setActiveThirdLevel(categories[0].id);
              }
            }}
            className={cn(
              "px-6 h-full text-sm font-medium transition-colors relative",
              activeSecondLevel === category.id
                ? "text-primary"
                : "text-muted-foreground hover:text-foreground"
            )}
          >
            {category.label}
            {activeSecondLevel === category.id && (
              <div className="absolute bottom-0 left-0 right-0 h-0.5 bg-primary" />
            )}
          </button>
        ))}
      </div>
    </div>

    <div className="flex flex-1 overflow-hidden">
      {/* 第三层导航 - 左侧边栏 */}
      <div className="w-48 border-r border-border bg-card overflow-y-auto">
        <div className="p-2">
          {currentCategories.length > 0 && (
            <div className="space-y-1">
              {currentCategories.map((category) => (
                <button
                  key={category.id}
                  onClick={() => scrollToCategory(category.id)}
                  className={cn(
                    "w-full text-left px-4 py-3 rounded-lg text-sm font-medium transition-colors mb-1",
                    activeThirdLevel === category.id
                      ? "bg-primary text-primary-foreground"
                      : "hover:bg-muted text-foreground"
                  )}
                >
                  {category.label}
                </button>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* 主内容区域 */}
      <div className="flex-1 p-6 overflow-y-auto">
        {currentCategories.length > 0 && (
          <>
            {currentCategories.map((category) => (
              <div key={category.id} id={`category-${category.id}`} className="mb-8">
                <h2 className="text-xl font-semibold mb-4">{category.label}</h2>

                {/* 卡片网格 - 关键布局 */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                  {category.templates.map((template) => (
                    <Card
                      key={template.id}
                      className="p-4 cursor-pointer hover:shadow-lg transition-shadow"
                      onClick={() => handleTemplateClick(template.id, template.title)}
                    >
                      {/* 关键：标题和图标在同一行 */}
                      <div className="flex items-start gap-3 mb-3">
                        <div className={cn("w-10 h-10 rounded-lg flex items-center justify-center text-xl shrink-0", template.color)}>
                          {template.icon}
                        </div>
                        <h3 className="font-medium text-sm flex-1">{template.title}</h3>
                      </div>
                      {/* 关键：描述独立在下方 */}
                      <p className="text-xs text-muted-foreground line-clamp-2">{template.desc}</p>
                    </Card>
                  ))}
                </div>
              </div>
            ))}
          </>
        )}
      </div>
    </div>
  </div>
);
```

**卡片结构注意事项：**
- ✅ 标题和图标在同一个flex容器中
- ✅ 描述独立在下方
- ❌ 不要将标题和描述放在嵌套的div中
- ✅ 使用 `shrink-0` 而不是 `flex-shrink-0`
- ✅ 标题使用 `flex-1` 占据剩余空间

### 步骤3：集成到主页面（components/writing-page.tsx）

#### 3.1 导入新模块组件
```typescript
import { [模块名]Page } from "./[模块名]-page";
```

#### 3.2 添加条件渲染
```typescript
{activeCategory === "[模块ID]" && <[模块名]Page />}
```

#### 3.3 更新滚动监听条件（如果需要）
```typescript
const shouldMonitorScroll =
  activeCategory !== "marketing" &&
  activeCategory !== "operation" &&
  activeCategory !== "[新模块ID]";
```

### 步骤4：测试检查清单

- [ ] 第二层导航切换正常
- [ ] 第三层导航切换正常
- [ ] 点击左侧导航能平滑滚动到对应分类
- [ ] 卡片点击能正确跳转
- [ ] 卡片样式与营销页面一致
- [ ] 响应式布局正常（手机、平板、桌面）
- [ ] 所有模板ID唯一且不冲突

### 步骤5：提交代码

```bash
git add lib/marketing-templates.ts components/[模块名]-page.tsx components/writing-page.tsx
git commit -m "feat([模块名]): 添加[模块名]模块完整功能

- 添加[X]个第二层分类
- 每个分类包含[Y]个子分类
- 共计[Z]个模板
- UI布局与营销模块保持一致"
git push
```

## 三、常见问题

### Q1: 卡片宽度不一致怎么办？
**A:** 检查卡片结构是否与营销页面完全一致。常见错误：
- 标题和描述被包裹在额外的div中
- 使用了 `flex-shrink-0` 而不是 `shrink-0`
- 缺少 `mb-3` 类

### Q2: 分类切换后内容不更新？
**A:** 确保使用 `getCategoriesById(category.id)` 直接获取分类，而不是依赖异步的state更新。

### Q3: 模板ID如何规划？
**A:**
- 为每个模块预留10000个ID空间
- 营销：10001-19999
- 运营：35001-44999
- 建议新模块从45001开始

### Q4: 如何确保样式一致？
**A:**
1. 直接复制营销页面的卡片结构
2. 使用相同的Tailwind类名
3. 不要添加额外的嵌套div

## 四、模板示例

### 完整的模板数据示例
```typescript
export const exampleTemplates = [
  {
    id: 45001,
    title: "市场调研报告",
    desc: "撰写专业的市场调研报告，分析市场趋势和竞争态势",
    icon: "📊",
    color: "bg-blue-500",
  },
  {
    id: 45002,
    title: "竞品分析",
    desc: "深入分析竞争对手的产品、策略和市场表现",
    icon: "🔍",
    color: "bg-green-500",
  },
  // ... 更多模板
];
```

## 五、开发时间估算

- 数据结构设计：1-2小时
- 组件开发：2-3小时
- 集成测试：1小时
- 总计：4-6小时/模块

## 六、参考文件

- 营销模块：`components/marketing-page.tsx`
- 运营模块：`components/operation-page.tsx`
- 模板数据：`lib/marketing-templates.ts`
- 主页面：`components/writing-page.tsx`
